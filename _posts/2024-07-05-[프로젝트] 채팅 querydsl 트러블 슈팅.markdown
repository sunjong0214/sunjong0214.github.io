---
title : [í”„ë¡œì íŠ¸] ì±„íŒ… querydsl projections ì‚¬ìš©ì‹œ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
category : [Spring]
tags : [spring, querydsl]
---

## Querydsl Projections ì‚¬ìš©ì‹œ ë°œìƒí•œ ë¬¸ì œ í•´ê²° ê³¼ì • 

í”„ë¡œì íŠ¸ ì§„í–‰ ì¤‘ ë°œìƒí•œ ì˜¤ë¥˜ì— ê´€í•´ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. 

### QueryDslì—ì„œ Projections.bean() ì‚¬ìš© ì‹œ ë°œìƒí•˜ëŠ” ExpressionException ì¼ìœ¼í‚¨ ê¸°ì¡´ ì½”ë“œ 

```java
package com.WalkiePaw.domain.chatroom.repository;

import com.WalkiePaw.presentation.domain.chatroom.dto.ChatroomListResponse;
import com.querydsl.core.types.Projections;
import com.querydsl.jpa.impl.JPAQueryFactory;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

import java.util.List;

import static com.WalkiePaw.domain.chatroom.entity.QChatroom.*;

@Repository
@RequiredArgsConstructor
public class ChatroomRepositoryOverrideImpl implements ChatroomRepositoryOverride {

    private final JPAQueryFactory jpaQueryFactory;

    @Override
    public List<ChatroomListResponse> findByMemberId(final Integer memberId) {
        return jpaQueryFactory
                .select(Projections.fields(ChatroomListResponse.class,
                        chatroom.id, chatroom.board.location, chatroom.member.nickname
                        , chatroom.latestMessage, chatroom.unreadCount
                ))
                .from(chatroom)
                .where(chatroom.board.id.eq(memberId).or(chatroom.member.id.eq(memberId)))
                .fetch();
    }
}


```


---
### ì—ëŸ¬ ë°œìƒ 

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-05 á„‹á…©á„’á…® 2 42 18](https://github.com/chaexrin/chaexrin.github.io/assets/150896440/63057299-aa09-46da-8161-6e28ae7527d2)

Projections.bean()ì€ ê¸°ë³¸ ìƒì„±ìì™€ setterë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤, ê·¸ë˜ì„œ í•´ë‹¹ DTOì— ê¸°ë³¸ìƒì„±ìê°€ ì—†ìœ¼ë©´ë©´ ì—ëŸ¬ê°€ ë°œìƒ!!!

ë˜í•œ setterê°€ ì—†ë‹¤ë©´ DTOì˜ í•„ë“œì— ê°’ì´ í• ë‹¹ë˜ì§€ ëª»í•´ì„œ ëª¨ë“  í•„ë“œê°€ nullì´ ë˜ë¯€ë¡œ ì£¼ì˜í•´ì•¼í•œë‹¤.




### ì˜¤ë¥˜ í•´ê²° ì „ ChatroomListResponse ì½”ë“œ
```java

package com.WalkiePaw.presentation.domain.chatroom.dto;

import com.WalkiePaw.domain.chatroom.entity.Chatroom;
import lombok.AllArgsConstructor;
import lombok.Data;


@Data
@AllArgsConstructor
public class ChatroomListResponse {
    private final Integer id;
    private final String location;
    private final String nickname;
    private final String latestMessage;
    private final int unreadCount;
    
    

    public static ChatroomListResponse from(final Chatroom chatroom) {
        return new ChatroomListResponse(chatroom.getId(), chatroom.getBoard().getLocation(),
                 chatroom.getMember().getNickname(), chatroom.getLatestMessage(), chatroom.getUnreadCount());
    }
}


```
### ì˜¤ë¥˜ í•´ê²° í›„ ChatroomListResponse ì½”ë“œ ğŸ§ğŸ»â€â™€ï¸

```java

package com.WalkiePaw.presentation.domain.chatroom.dto;

import com.WalkiePaw.domain.chatroom.entity.Chatroom;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;


@Data
@AllArgsConstructor
@NoArgsConstructor
public class ChatroomListResponse {
    private Integer id;
    private String location;
    private String nickname;
    private String latestMessage;
    private int unreadCount;

    public static ChatroomListResponse from(final Chatroom chatroom) {
        return new ChatroomListResponse(chatroom.getId(), chatroom.getBoard().getLocation(),
                 chatroom.getMember().getNickname(), chatroom.getLatestMessage(), chatroom.getUnreadCount());
    }
}


```

#### ğŸ§  `ê²°ë¡  : Projectionì—ì„œ ì‚¬ìš©í•  DTOì—ëŠ” @NoArgsConstructorì™€ @Setterë¥¼ ê¼­ ë¶™ì´ì`
